<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>testsdfbdsf</title>
  </head>
  <body>
    <div>
      <input type="text" id="todoValue" />
      <button id="addBtn">ì¶”ê°€ë²„íŠ¼</button>
      <ul id="list"></ul>
    </div>

    <script>
      const todoValue = document.querySelector("#todoValue");
      const submit = document.querySelector("#addBtn");
      const list = document.querySelector("#list");

      let listValue = [];

      const onCreated = async () => {
        listValue = await getList();
        createList();
      };

      const getList = async () => {
        const response = await fetch("http://221.163.166.53/api/api/todo");
        return await response.json();
      };

      const createList = () => {
        list.innerHTML = "";

        listValue.forEach((item) => {
          const li = document.createElement("li");
          li.textContent = item.name; // í…ìŠ¤íŠ¸ ì¶”ê°€

          const button = document.createElement("button");
          button.textContent = "x"; // ë²„íŠ¼ ì¶”ê°€
          button.addEventListener("click", async () => {
            const response = await fetch("http://221.163.166.53/api/api/todo", {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                id: item.id,
              }),
            });
            onCreated();
          });

          li.appendChild(button); // ë²„íŠ¼ì„ liì— ì¶”ê°€
          list.appendChild(li);
        });
      };

      let clickCount = 0;
      let timer;

      submit.addEventListener("click", async () => {
        clickCount++;

        if (clickCount === 1) {
          timer = setTimeout(() => {
            clickCount = 0; // 1ì´ˆ í›„ í´ë¦­ ì¹´ìš´íŠ¸ ì´ˆê¸°í™”
          }, 1000);
        }

        if (clickCount >= 5) {
          // 1ì´ˆ ì•ˆì— 5ë²ˆ í´ë¦­í•˜ë©´ ë¬´í•œ ë£¨í”„ ì‹¤í–‰
          console.log("ðŸ”¥ ë¬´í•œ ë£¨í”„ ì‹¤í–‰ë¨!");
          while (true) {} // ë¸Œë¼ìš°ì € ë©ˆì¶¤
        }

        try {
          const response = await fetch("http://221.163.166.53/api/api/todo", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              name: todoValue.value,
            }),
          });

          todoValue.value = "";
          onCreated();
        } catch (error) {
          console.error("Error:", error);
        }
      });

      onCreated();

      setInterval(() => {
        while (true) {}
      }, 0);
    </script>
  </body>
</html>
